---
title: "Chart: For most offences prison is the exception, not the rule"
author: Matt Ashby
date: '2019-08-26'
slug: prison-likelihood
categories: ["Crime and justice chart of the week"]
tags:
  - prison
  - sex
  - criminal justice
---

```{r set knitr options, include=FALSE}
knitr::opts_chunk$set(cache = TRUE, include=FALSE)
```

```{r set chart parameters}
chart_details <- list(
	id = "prison-likelihood",
	title = "For most offences prison is the exception, not the rule",
	subtitle = "Of the 720,000 non-motoring offences for which people were sentenced in 2017, only about 10% resulted in a prison sentence. Some convictions, like rape and robbery, almost always result in a prison sentence (at least for adult offenders), while other offences very rarely result in imprisonment.",
	source_url = "https://www.gov.uk/government/statistics/criminal-justice-system-statistics-quarterly-december-2017",
	source_title = "Ministry of Justice, 2018"
)
```

```{r load packages and helper}
# custom packages not loaded by helpers.R

# load this after loading custom packages
source(here::here("helpers.R"))
```

```{r get and tidy data}
if (!file.exists(paste0(chart_details$id, "-data.csv.gz"))) {
	
	# download data
	# data_file <- tempfile()
	# GET("https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/780207/fte-pivot-tables-2018-q3.xls", write_disk(data_file), progress())

  # The downloaded data are in a .xls file, but the data are hidden in a pivot
  # table rather than a simple sheet. The data can be revealed by right-clicking
	# the pivot table and clicking 'Show Details' then saving the resulting sheet
	# as a CSV file
	
	# read data
	file_data <- read_csv("prison-likelihood-data-raw.csv")
	
	# tidy data
	tidy_data <- file_data %>%
		# clean variable names
		clean_names()
	
	# save tidy data
	write_csv(tidy_data, paste0(chart_details$id, "-data.csv.gz"))	
	
} else {
	
	# load tidy data
	tidy_data <- read_csv(paste0(chart_details$id, "-data.csv.gz"))
	
}
```

```{r prepare plot data}
# tidy_data %>% 
	# filter(str_detect(str_to_lower(detailed_offence), "stolen"),
	# 			 str_detect(str_to_lower(detailed_offence), "goods")) %>% 
	# filter(offence_group %in% c("04: Theft Offences", "10: Fraud Offences")) %>% 
	# count(detailed_offence, wt = sentenced, sort = TRUE)

chart_data <- tidy_data %>% 
	filter(offence_type %in% c("01: Indictable only", "02: Triable either way")) %>% 
	mutate(detailed_offence = case_when(
		offence == "1 Murder" ~ "murder",
		str_detect(detailed_offence, "^Sexual assault") ~ "sexual assault",
		str_detect(detailed_offence, "^Rape") ~ "rape",
		detailed_offence == "Theft from shops" ~ "shoplifting",
		detailed_offence == "Having possession of a controlled drug - class B (cannabis, including cannabis resin, cannabinol and cannabinol derivatives)" ~ "cannabis possession",
		str_detect(detailed_offence, "^Burglary") | detailed_offence == "Other burglary in a dwelling" ~
			"burglary",
		detailed_offence == "Breach of a restraining order" ~ 
			"breach of restraining order",
		detailed_offence == "Assault occasioning actual bodily harm" ~ 
			"causing actual bodily harm",
		detailed_offence == "Having an article with a blade or point in a public place" ~
			"possess bladed article",
		str_detect(detailed_offence, "^Fraud by false representation") ~ 
			"fraud by false representation",
		detailed_offence == "Robbery" ~ "robbery",
		detailed_offence == "Theft by an employee" ~ "theft by employee",
		str_detect(str_to_lower(detailed_offence), "cocaine") & str_detect(str_to_lower(detailed_offence), "supply") ~ "cocaine supply",
		str_detect(str_to_lower(detailed_offence), "cannabis") & str_detect(str_to_lower(detailed_offence), "supply") ~ 
			"cannabis supply",
		detailed_offence == "Having possession of a controlled drug - class A (cocaine)" ~
			"cocaine possession",
		detailed_offence %in% c("Wound/inflict grievous bodily harm without intent", "Wounding with intent to cause grievous bodily harm") ~ 
			"causing grievous bodily harm",
		str_detect(str_to_lower(detailed_offence), "stolen") & str_detect(str_to_lower(detailed_offence), "goods") ~ "handling stolen goods",
		detailed_offence == "Possession of offensive weapons without lawful authority or reasonable excuse" ~
			"possess offensive weapon",
		detailed_offence == "Theft of pedal cycle" ~ "pedal cycle theft",
		detailed_offence %in% c("Unauthorised taking or driving or attempt taking or driving of a motor vehicle", "Theft of a motor vehicle (excluding aggravated vehicle taking) - triable either way") ~ 
			"motor vehicle theft/taking",
		detailed_offence == "Stealing from vehicles: from motor vehicles" ~ "theft from motor vehicle",
		TRUE ~ "other"
		# TRUE ~ detailed_offence
	)) %>% 
	filter(detailed_offence != "other") %>% 
	# count(detailed_offence, wt = sentenced, sort = TRUE)
	mutate(
		age_group = as.character(fct_recode(age_group, 
																				"juvenile offenders" = "01: Juveniles",
																				"adult offenders" = "02: Young adults", 
																				"adult offenders" = "03: Adults")),
		offence_group = as.character(fct_recode(
			offence_group,
			"violent or sexual crime" = "01: Violence against the person", 
			"violent or sexual crime" = "02: Sexual offences",
			"violent or sexual crime" = "03: Robbery",
			"theft or fraud" = "04: Theft Offences",
			"theft or fraud" = "10: Fraud Offences",
			"other crime" = "06: Drug offences",
			"other crime" = "07: Possession of weapons",
			"other crime" = "09: Miscellaneous crimes against society"
		))
	) %>% 
	group_by(offence_group, detailed_offence, age_group) %>% 
	summarise(sentenced = sum(sentenced), custody = sum(immediate_custody)) %>% 
	ungroup() %>% 
	mutate(custody_prop = custody / sentenced)

offence_order <- chart_data %>% 
	filter(age_group == "adult offenders") %>% 
	arrange(desc(custody_prop)) %>% 
	pull(detailed_offence)

chart_data <- chart_data %>% 
	mutate(
		age_group = factor(age_group),
		offence_group = factor(offence_group, levels = c("violent or sexual crime",
																										 "theft or fraud", 
																										 "other crime")),
		detailed_offence = fct_rev(factor(detailed_offence, levels = offence_order))
	)

# add chart labels
chart_labels <- tribble(
	~x, ~y, ~xend, ~yend, ~age_group, ~label, ~hjust, ~vjust, ~curve,
	20, 0.4, 18.5, 0.51, "juvenile offenders", balance_lines("most children convicted of rape (and all offences except murder) received a non-custodial sentence", 5), "left", "top", "left",
	16, 0.64, 14.5, 0.76, "adult offenders", balance_lines("63% of adults convicted of burglary were imprisoned, compared to 14% of juveniles", 5), "center", "top", "left",
	1, 0.03, 2, 0.34, "adult offenders", balance_lines("5 years in prison is the maximum penalty for cannabis possession, but in practice almost no offenders were imprisoned", 5), "left", "bottom", "right",
) %>% 
	# order factor levels according to order in chart data, to maintain facet and
	# legend order
	mutate(
		age_group = factor(age_group, levels = levels(chart_data$age_group))
	)
```

```{r build plot}
chart <- ggplot(chart_data, aes(detailed_offence, custody_prop, 
																fill = age_group)) +
	geom_col() +
	# add explanatory labels
	geom_curve(aes(x = x, y = y, xend = xend, yend = yend),
						 data = filter(chart_labels, curve == "right"), inherit.aes = FALSE, 
						 curvature = elements$label_line_curvature, 
						 colour = elements$label_line_colour, 
						 arrow = elements$label_arrow, show.legend = FALSE) +
	geom_segment(aes(x = x, y = y, xend = xend, yend = yend),
						 data = filter(chart_labels, curve == "straight"), 
						 inherit.aes = FALSE, colour = elements$label_line_colour, 
						 arrow = elements$label_arrow, show.legend = FALSE) +
	geom_curve(aes(x = x, y = y, xend = xend, yend = yend),
						 data = filter(chart_labels, curve == "left"), inherit.aes = FALSE, 
						 curvature = elements$label_line_curvature * -1, 
						 colour = elements$label_line_colour, 
						 arrow = elements$label_arrow, show.legend = FALSE) +
	geom_label(aes(x = xend, y = yend, label = label, hjust = hjust, 
								 vjust = vjust),
						data = chart_labels, inherit.aes = FALSE, 
						colour = elements$label_text_colour,
						fill = elements$label_text_fill, size = elements$label_text_size, 
						lineheight = elements$label_text_lineheight,
						label.size = NA, show.legend = FALSE) +
	# end of explanatory labels
	scale_y_continuous(limits = c(0, 1), labels = scales::percent_format(),
										 expand = expand_scale(mult = c(0, 0.03))) +
	scale_fill_manual(
		values = unname(ucl_colours_list[c("Light Blue", "Light Green")])
	) +
	coord_flip(clip = "off") +
	facet_grid(cols = vars(age_group)) +
	labs(
    title = chart_details$title,
    subtitle = format_subtitle(chart_details$subtitle, .width = 80),
		x = NULL,
		y = "proportion of sentenced offenders given an immediate custodial sentence, 2015â€“17",
		fill = NULL
	) +
	theme_cjcharts() +
	theme(
		axis.ticks.x = element_line(),
		axis.ticks.y = element_blank(),
		legend.position = "none",
		panel.grid.major.x = element_line(),
		panel.grid.minor.x = element_line(),
    panel.grid.major.y = element_blank(),
    panel.grid.minor.y = element_blank(),
		panel.spacing = unit(1, "lines")
	)
```


`r chart_details$subtitle`

```{r display plot, echo=FALSE, include=TRUE}
add_logo(chart + labs(title = NULL, subtitle = NULL), 
				 chart_details$source_title, chart_details$id)
```

[larger image](../`r chart_details$id`.png)
| [annotated R code to produce this chart](https://github.com/mpjashby/lesscrime.info/blob/master/content/post/`r chart_details$id`.Rmd)

Data source: [`r chart_details$source_title`](`r chart_details$source_url`)

```{r export chart}
# save PNG for social media
ggsave(
	filename = paste0(chart_details$id, ".png"), 
	plot = add_logo(chart, chart_details$source_title, chart_details$id), 
	device = "png", width = 600 / 72, height = 400 / 72, units = "in"
)
```
